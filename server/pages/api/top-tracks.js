(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[727],{898(e,t,r){"use strict";r.r(t),r.d(t,{default:()=>i});var s=r(316);(0,s.gL)();var n=r(612),o=n.middleware||n.default;if("function"!=typeof o)throw Error('The Edge Function "pages/api/top-tracks" must export a `default` function');function i(e){return(0,s.VL)({...e,page:"/api/top-tracks",handler:o})}},51(e,t,r){"use strict";r.d(t,{V:()=>h,e:()=>l});let s=process.env.SPOTIFY_CLIENT_ID,n=process.env.SPOTIFY_CLIENT_SECRET,o=process.env.SPOTIFY_REFRESH_TOKEN,i=btoa(`${s}:${n}`),a=async()=>{let e=await fetch("https://accounts.spotify.com/api/token",{method:"POST",headers:{Authorization:`Basic ${i}`,"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({grant_type:"refresh_token",refresh_token:o})});return e.json()},l=async()=>{let{access_token:e}=await a();return fetch("https://api.spotify.com/v1/me/player/currently-playing",{headers:{Authorization:`Bearer ${e}`}})},h=async()=>{let{access_token:e}=await a();return fetch("https://api.spotify.com/v1/me/top/tracks",{headers:{Authorization:`Bearer ${e}`}})}},612(e,t,r){"use strict";r.r(t),r.d(t,{config:()=>n,default:()=>o});var s=r(51);let n={runtime:"experimental-edge"};async function o(e){let t=await (0,s.V)(),{items:r}=await t.json(),n=r.slice(0,10).map(e=>({artist:e.artists.map(e=>e.name).join(", "),songUrl:e.external_urls.spotify,title:e.name}));return new Response(JSON.stringify({tracks:n}),{status:200,headers:{"content-type":"application/json","cache-control":"public, s-maxage=86400, stale-while-revalidate=43200"}})}},316(e,t,r){"use strict";r.d(t,{VL:()=>N,gL:()=>F});class s extends Error{constructor({page:e}){super(`The middleware "${e}" accepts an async API directly with the form:
  
  export function middleware(request, event) {
    return NextResponse.redirect('/new-location')
  }
  
  Read more: https://nextjs.org/docs/messages/middleware-new-signature
  `)}}class n extends Error{constructor(){super(`The request.page has been deprecated in favour of \`URLPattern\`.
  Read more: https://nextjs.org/docs/messages/middleware-request-page
  `)}}class o extends Error{constructor(){super(`The request.ua has been removed in favour of \`userAgent\` function.
  Read more: https://nextjs.org/docs/messages/middleware-parse-user-agent
  `)}}function i(e){let t={};if(e)for(let[r,s]of e.entries())t[r]=s,"set-cookie"===r.toLowerCase()&&(t[r]=function(e){var t,r,s,n,o,i=[],a=0;function l(){for(;a<e.length&&/\s/.test(e.charAt(a));)a+=1;return a<e.length}for(;a<e.length;){for(t=a,o=!1;l();)if(","===(r=e.charAt(a))){for(s=a,a+=1,l(),n=a;a<e.length&&"="!==(r=e.charAt(a))&&";"!==r&&","!==r;)a+=1;a<e.length&&"="===e.charAt(a)?(o=!0,a=n,i.push(e.substring(t,s)),t=a):a=s+1}else a+=1;(!o||a>=e.length)&&i.push(e.substring(t,e.length))}return i}(s));return t}function a(e){try{return String(new URL(String(e)))}catch(t){throw Error(`URL is malformed "${String(e)}". Please use only absolute URLs - https://nextjs.org/docs/messages/middleware-relative-urls`,{cause:t})}}let l=Symbol("response"),h=Symbol("passThrough"),u=Symbol("waitUntil");class d{[u]=[];[h]=!1;constructor(e){}respondWith(e){this[l]||(this[l]=Promise.resolve(e))}passThroughOnException(){this[h]=!0}waitUntil(e){this[u].push(e)}}class c extends d{constructor(e){super(e.request),this.sourcePage=e.page}get request(){throw new s({page:this.sourcePage})}respondWith(){throw new s({page:this.sourcePage})}}function p(e){return e.replace(/\/$/,"")||"/"}function f(e){let t=e.indexOf("#"),r=e.indexOf("?"),s=r>-1&&(t<0||r<t);return s||t>-1?{pathname:e.substring(0,s?r:t),query:s?e.substring(r,t>-1?t:void 0):"",hash:t>-1?e.slice(t):""}:{pathname:e,query:"",hash:""}}function g(e,t){if(!e.startsWith("/")||!t)return e;let{pathname:r,query:s,hash:n}=f(e);return`${t}${r}${s}${n}`}function m(e,t){if(!e.startsWith("/")||!t)return e;let{pathname:r,query:s,hash:n}=f(e);return`${r}${t}${s}${n}`}function w(e,t){if("string"!=typeof e)return!1;let{pathname:r}=f(e);return r===t||r.startsWith(t+"/")}let x=/(?!^https?:\/\/)(127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}|::1|localhost)/;function y(e,t){return new URL(String(e).replace(x,"localhost"),t&&String(t).replace(x,"localhost"))}let _=Symbol("NextURLInternal");class b{constructor(e,t,r){let s,n;"object"==typeof t&&"pathname"in t||"string"==typeof t?(s=t,n=r||{}):n=r||t||{},this[_]={url:y(e,s??n.base),options:n,basePath:""},this.analyzeUrl()}analyzeUrl(){var e,t,r,s,n,o,i,a;let l=function(e,t){var r;let{basePath:s,i18n:n,trailingSlash:o}=null!=(r=t.nextConfig)?r:{},i={pathname:e,trailingSlash:"/"!==e?e.endsWith("/"):o};if(s&&w(i.pathname,s)&&(i.pathname=function(e,t){if(w(e,t)){let r=e.slice(t.length);return r.startsWith("/")?r:`/${r}`}return e}(i.pathname,s),i.basePath=s),!0===t.parseData&&i.pathname.startsWith("/_next/data/")&&i.pathname.endsWith(".json")){let a=i.pathname.replace(/^\/_next\/data\//,"").replace(/\.json$/,"").split("/"),l=a[0];i.pathname="index"!==a[1]?`/${a.slice(1).join("/")}`:"/",i.buildId=l}if(n){let h=function(e,t){let r;let s=e.split("/");return(t||[]).some(t=>!!s[1]&&s[1].toLowerCase()===t.toLowerCase()&&(r=t,s.splice(1,1),e=s.join("/")||"/",!0)),{pathname:e,detectedLocale:r}}(i.pathname,n.locales);i.locale=null==h?void 0:h.detectedLocale,i.pathname=(null==h?void 0:h.pathname)||i.pathname}return i}(this[_].url.pathname,{nextConfig:this[_].options.nextConfig,parseData:!0});this[_].domainLocale=function(e,t,r){let s;if(e)for(let n of(r&&(r=r.toLowerCase()),e)){var o,i;let a=null==(o=n.domain)?void 0:o.split(":")[0].toLowerCase();if(t===a||r===n.defaultLocale.toLowerCase()||(null==(i=n.locales)?void 0:i.some(e=>e.toLowerCase()===r))){s=n;break}}return s}(null==(e=this[_].options.nextConfig)?void 0:null==(t=e.i18n)?void 0:t.domains,(o=this[_].url,null==(a=!Array.isArray(null==(i=this[_].options.headers)?void 0:i.host)&&(null==i?void 0:i.host)||o.hostname)?void 0:a.split(":")[0].toLowerCase()));let h=(null==(r=this[_].domainLocale)?void 0:r.defaultLocale)||(null==(s=this[_].options.nextConfig)?void 0:null==(n=s.i18n)?void 0:n.defaultLocale);this[_].url.pathname=l.pathname,this[_].defaultLocale=h,this[_].basePath=l.basePath??"",this[_].buildId=l.buildId,this[_].locale=l.locale??h,this[_].trailingSlash=l.trailingSlash}formatPathname(){var e,t,r,s,n;let o;return t=(e={basePath:this[_].basePath,buildId:this[_].buildId,defaultLocale:this[_].options.forceLocale?void 0:this[_].defaultLocale,locale:this[_].locale,pathname:this[_].url.pathname,trailingSlash:this[_].trailingSlash}).pathname,r=e.locale,s=e.buildId?void 0:e.defaultLocale,n=e.ignorePrefix,o=r&&r!==s&&(n||!w(t.toLowerCase(),`/${r.toLowerCase()}`)&&!w(t.toLowerCase(),"/api"))?g(t,`/${r}`):t,(e.buildId||!e.trailingSlash)&&(o=p(o)),e.buildId&&(o=m(g(o,`/_next/data/${e.buildId}`),"/"===e.pathname?"index.json":".json")),o=g(o,e.basePath),!e.buildId&&e.trailingSlash?o.endsWith("/")?o:m(o,"/"):p(o)}formatSearch(){return this[_].url.search}get buildId(){return this[_].buildId}set buildId(e){this[_].buildId=e}get locale(){return this[_].locale??""}set locale(e){var t,r;if(!this[_].locale||!(null==(t=this[_].options.nextConfig)?void 0:null==(r=t.i18n)?void 0:r.locales.includes(e)))throw TypeError(`The NextURL configuration includes no locale "${e}"`);this[_].locale=e}get defaultLocale(){return this[_].defaultLocale}get domainLocale(){return this[_].domainLocale}get searchParams(){return this[_].url.searchParams}get host(){return this[_].url.host}set host(e){this[_].url.host=e}get hostname(){return this[_].url.hostname}set hostname(e){this[_].url.hostname=e}get port(){return this[_].url.port}set port(e){this[_].url.port=e}get protocol(){return this[_].url.protocol}set protocol(e){this[_].url.protocol=e}get href(){let e=this.formatPathname(),t=this.formatSearch();return`${this.protocol}//${this.host}${e}${t}${this.hash}`}set href(e){this[_].url=y(e),this.analyzeUrl()}get origin(){return this[_].url.origin}get pathname(){return this[_].url.pathname}set pathname(e){this[_].url.pathname=e}get hash(){return this[_].url.hash}set hash(e){this[_].url.hash=e}get search(){return this[_].url.search}set search(e){this[_].url.search=e}get password(){return this[_].url.password}set password(e){this[_].url.password=e}get username(){return this[_].url.username}set username(e){this[_].url.username=e}get basePath(){return this[_].basePath}set basePath(e){this[_].basePath=e.startsWith("/")?e:`/${e}`}toString(){return this.href}toJSON(){return this.href}[Symbol.for("edge-runtime.inspect.custom")](){return{href:this.href,origin:this.origin,protocol:this.protocol,username:this.username,password:this.password,host:this.host,hostname:this.hostname,port:this.port,pathname:this.pathname,search:this.search,searchParams:this.searchParams,hash:this.hash}}clone(){return new b(String(this),this[_].options)}}let v=["strict","lax","none"];function S(e){let t=["path"in e&&e.path&&`Path=${e.path}`,"expires"in e&&e.expires&&`Expires=${e.expires.toUTCString()}`,"maxAge"in e&&e.maxAge&&`Max-Age=${e.maxAge}`,"domain"in e&&e.domain&&`Domain=${e.domain}`,"secure"in e&&e.secure&&"Secure","httpOnly"in e&&e.httpOnly&&"HttpOnly","sameSite"in e&&e.sameSite&&`SameSite=${e.sameSite}`].filter(Boolean);return`${e.name}=${encodeURIComponent(e.value??"")}; ${t.join("; ")}`}function L(e){let t=new Map;for(let r of e.split(/; */)){if(!r)continue;let[s,n]=r.split("=",2);t.set(s,decodeURIComponent(n??"true"))}return t}class ${_parsed=new Map;constructor(e){this._headers=e;let t=e.get("cookie");if(t){let r=L(t);for(let[s,n]of r)this._parsed.set(s,{name:s,value:n})}}[Symbol.iterator](){return this._parsed[Symbol.iterator]()}get size(){return this._parsed.size}get(...e){let t="string"==typeof e[0]?e[0]:e[0].name;return this._parsed.get(t)}getAll(...e){var t;let r=Array.from(this._parsed);if(!e.length)return r.map(([e,t])=>t);let s="string"==typeof e[0]?e[0]:null==(t=e[0])?void 0:t.name;return r.filter(([e])=>e===s).map(([e,t])=>t)}has(e){return this._parsed.has(e)}set(...e){let[t,r]=1===e.length?[e[0].name,e[0].value]:e,s=this._parsed;return s.set(t,{name:t,value:r}),this._headers.set("cookie",Array.from(s).map(([e,t])=>S(t)).join("; ")),this}delete(e){let t=this._parsed,r=Array.isArray(e)?e.map(e=>t.delete(e)):t.delete(e);return this._headers.set("cookie",Array.from(t).map(([e,t])=>S(t)).join("; ")),r}clear(){return this.delete(Array.from(this._parsed.keys())),this}[Symbol.for("edge-runtime.inspect.custom")](){return`RequestCookies ${JSON.stringify(Object.fromEntries(this._parsed))}`}}class C{_parsed=new Map;constructor(e){this._headers=e;let t=this._headers.getAll("set-cookie");for(let r of t){let s=function(e){var t;if(!e)return;let[[r,s],...n]=L(e),{domain:o,expires:i,httponly:a,maxage:l,path:h,samesite:u,secure:d}=Object.fromEntries(n.map(([e,t])=>[e.toLowerCase(),t])),c={name:r,value:decodeURIComponent(s),domain:o,...i&&{expires:new Date(i)},...a&&{httpOnly:!0},..."string"==typeof l&&{maxAge:Number(l)},path:h,...u&&{sameSite:(t=(t=u).toLowerCase(),v.includes(t)?t:void 0)},...d&&{secure:!0}};return function(e){let t={};for(let r in e)e[r]&&(t[r]=e[r]);return t}(c)}(r);s&&this._parsed.set(s.name,s)}}get(...e){let t="string"==typeof e[0]?e[0]:e[0].name;return this._parsed.get(t)}getAll(...e){var t;let r=Array.from(this._parsed.values());if(!e.length)return r;let s="string"==typeof e[0]?e[0]:null==(t=e[0])?void 0:t.name;return r.filter(e=>e.name===s)}set(...e){let[t,r,s]=1===e.length?[e[0].name,e[0].value,e[0]]:e,n=this._parsed;return n.set(t,function(e={name:"",value:""}){return e.maxAge&&(e.expires=new Date(Date.now()+1e3*e.maxAge)),(null===e.path||void 0===e.path)&&(e.path="/"),e}({name:t,value:r,...s})),!function(e,t){for(let[,r]of(t.delete("set-cookie"),e)){let s=S(r);t.append("set-cookie",s)}}(n,this._headers),this}delete(...e){let t="string"==typeof e[0]?e[0]:e[0].name;return this.set({name:t,value:"",expires:new Date(0)})}[Symbol.for("edge-runtime.inspect.custom")](){return`ResponseCookies ${JSON.stringify(Object.fromEntries(this._parsed))}`}}let P=Symbol("internal request");class I extends Request{constructor(e,t={}){let r="string"!=typeof e&&"url"in e?e.url:String(e);a(r),super(r,t),this[P]={cookies:new $(this.headers),geo:t.geo||{},ip:t.ip,url:new b(r,{headers:i(this.headers),nextConfig:t.nextConfig})}}[Symbol.for("edge-runtime.inspect.custom")](){return{cookies:this.cookies,geo:this.geo,ip:this.ip,nextUrl:this.nextUrl,url:this.url,bodyUsed:this.bodyUsed,cache:this.cache,credentials:this.credentials,destination:this.destination,headers:Object.fromEntries(this.headers),integrity:this.integrity,keepalive:this.keepalive,method:this.method,mode:this.mode,redirect:this.redirect,referrer:this.referrer,referrerPolicy:this.referrerPolicy,signal:this.signal}}get cookies(){return this[P].cookies}get geo(){return this[P].geo}get ip(){return this[P].ip}get nextUrl(){return this[P].url}get page(){throw new n}get ua(){throw new o}get url(){return this[P].url.toString()}}let E=Symbol("internal response"),k=new Set([301,302,303,307,308]);function j(e,t){var r;if(null==e?void 0:null==(r=e.request)?void 0:r.headers){if(!(e.request.headers instanceof Headers))throw Error("request.headers must be an instance of Headers");let s=[];for(let[n,o]of e.request.headers)t.set("x-middleware-request-"+n,o),s.push(n);t.set("x-middleware-override-headers",s.join(","))}}class q extends Response{constructor(e,t={}){super(e,t),this[E]={cookies:new C(this.headers),url:t.url?new b(t.url,{headers:i(this.headers),nextConfig:t.nextConfig}):void 0}}[Symbol.for("edge-runtime.inspect.custom")](){return{cookies:this.cookies,url:this.url,body:this.body,bodyUsed:this.bodyUsed,headers:Object.fromEntries(this.headers),ok:this.ok,redirected:this.redirected,status:this.status,statusText:this.statusText,type:this.type}}get cookies(){return this[E].cookies}static json(e,t){let r=Response.json(e,t);return new q(r.body,r)}static redirect(e,t){let r="number"==typeof t?t:(null==t?void 0:t.status)??307;if(!k.has(r))throw RangeError('Failed to execute "redirect" on "response": Invalid status code');let s="object"==typeof t?t:{},n=new Headers(null==s?void 0:s.headers);return n.set("Location",a(e)),new q(null,{...s,headers:n,status:r})}static rewrite(e,t){let r=new Headers(null==t?void 0:t.headers);return r.set("x-middleware-rewrite",a(e)),j(t,r),new q(null,{...t,headers:r})}static next(e){let t=new Headers(null==e?void 0:e.headers);return t.set("x-middleware-next","1"),j(e,t),new q(null,{...e,headers:t})}}function R(e,t){let r="string"==typeof t?new URL(t):t,s=new URL(e,t),n=`${r.protocol}//${r.host}`;return`${s.protocol}//${s.host}`===n?s.toString().replace(n,""):s.toString()}let U=["__nextFallback","__nextLocale","__nextDefaultLocale","__nextIsNotFound","__rsc__","__next_router_state_tree__","__next_router_prefetch__"],A=["__nextDataReq"];class T extends I{constructor(e){super(e.input,e.init),this.sourcePage=e.page}get request(){throw new s({page:this.sourcePage})}respondWith(){throw new s({page:this.sourcePage})}waitUntil(){throw new s({page:this.sourcePage})}}let O=["__rsc__","__next_router_state_tree__","__next_router_prefetch__"];async function N(e){let t=void 0!==self.__BUILD_MANIFEST;e.request.url=e.request.url.replace(/\.rsc($|\?)/,"");let r=new b(e.request.url,{headers:e.request.headers,nextConfig:e.request.nextConfig}),s=r.buildId;r.buildId="";let n=e.request.headers["x-nextjs-data"];n&&"/index"===r.pathname&&(r.pathname="/");let o=function(e){let t=new Headers;for(let[r,s]of Object.entries(e)){let n=Array.isArray(s)?s:[s];for(let o of n)void 0!==o&&t.append(r,o)}return t}(e.request.headers);if(!t)for(let i of O)o.delete(i);!function(e,t){for(let r of U)e.delete(r);if(t)for(let s of A)e.delete(s)}(r.searchParams,!0);let a=new T({page:e.page,input:String(r),init:{body:e.request.body,geo:e.request.geo,headers:o,ip:e.request.ip,method:e.request.method,nextConfig:e.request.nextConfig}});n&&Object.defineProperty(a,"__isData",{enumerable:!1,value:!0});let l=new c({request:a,page:e.page}),h=await e.handler(a,l);if(h&&!(h instanceof Response))throw TypeError("Expected an instance of Response to be returned");let d=null==h?void 0:h.headers.get("x-middleware-rewrite");if(h&&d){let p=new b(d,{forceLocale:!0,headers:e.request.headers,nextConfig:e.request.nextConfig});p.host===a.nextUrl.host&&(p.buildId=s||p.buildId,h.headers.set("x-middleware-rewrite",String(p))),n&&h.headers.set("x-nextjs-rewrite",R(String(p),String(r)))}let f=null==h?void 0:h.headers.get("Location");if(h&&f){let g=new b(f,{forceLocale:!1,headers:e.request.headers,nextConfig:e.request.nextConfig});h=new Response(h.body,h),g.host===a.nextUrl.host&&(g.buildId=s||g.buildId,h.headers.set("Location",String(g))),n&&(h.headers.delete("Location"),h.headers.set("x-nextjs-redirect",R(String(g),String(r))))}return{response:h||q.next(),waitUntil:Promise.all(l[u])}}function D(e){return`The edge runtime does not support Node.js '${e}' module.
Learn More: https://nextjs.org/docs/messages/node-module-in-edge-runtime`}function W(e){let t=new Proxy(function(){},{get(t,r){if("then"===r)return{};throw Error(D(e))},construct(){throw Error(D(e))},apply(r,s,n){if("function"==typeof n[0])return n[0](t);throw Error(D(e))}});return new Proxy({},{get:()=>t})}function F(){process!==r.g.process&&(process.env=r.g.process.env,r.g.process=process),Object.defineProperty(globalThis,"__import_unsupported",{value:W,enumerable:!1,configurable:!1})}}},e=>{var t=e(e.s=898);(_ENTRIES="undefined"==typeof _ENTRIES?{}:_ENTRIES)["middleware_pages/api/top-tracks"]=t}]);
//# sourceMappingURL=top-tracks.js.map